# Мотивация

Документ описывает ежедневные задачи веб-разработки, которые решает библиотека bem-react-core.

-------------

Чтобы объяснить причины создания библиотеки bem-react-core, мы собрали актуальные задачи React-разработчиков, которые не решает текущая реализация React:
* [Декомпозиция](#Декомпозиция)
* [Повторное использование кода](#Повторное-использование-кода)
* [Кроссплатформенная разработка](#Кроссплатформенная-разработка)
* [Эксперименты](#Эксперименты)
* [Взаимодействие общей библиотеки компонентов и разных проектов](#Взаимодействие-общей-библиотеки-компонентов-и-разных-проектов)

## Декомпозиция

Чтобы эффективно использовать универсальные компоненты, необходимо иметь возможность удобно переопределять их и включать в сборку только нужный код.

Современный универсальный компонент должен решать множество задач для разных устройств и интерфейсов. Это усложняет функциональность компонентов и увеличивает количество одновременно возможных вариаций. 

Основная часть логики в классическом React-компоненте заключена в методе `render()`. Чтобы перенести, переопределить или доопределить функциональность компонента, необходимо переписать большую часть метода.

В React-подходе вариативность компонента выражается с помощью произвольных условий в коде в императивном стиле. Большое количество таких условий приводит к тому, что одна функциональность реализуется в разных местах в коде компонента. В случае опциональной вариативности, когда необходимо сочетать только часть из всех условий, в рантайм всегда будет загружаться лишний код. 

Большое количество вариаций в коде усложняет:
* оценку всех возможностей компонента;
* расширение и изменение компонентов;
* создание нужной комбинации условий, которые выполняются в рантайме.

> Библиотека bem-react-core поддерживает декларативное описание компонента. Вариативность описывается с помощью модификаторов. Чтобы модифицировать компонент, достаточно указать модификатор и его значение в декларации этого компонента.

## Повторное использование кода
 
Чтобы создавать и применять универсальные многофункциональные компоненты, необходимо уметь реиспользовать общий код этих компонентов.

Текущая реализация React поддерживает следующие способы повторного использования кода: 
* классическое наследование
* High Order Components

Наследование обладает рядом [общеизвестных](https://en.wikipedia.org/wiki/Composition_over_inheritance) проблем и не позволяет комбинировать несколько ортогональных признаков без полного перепроектирования иерархии классов.

Применение Hight Order Components при композиции нескольких компонентов, которые отвечают за разные аспекты функциональности, приводит к «раздутию» виртуального дерева и использованию `React.cloneElement`.

> Библиотека bem-react-core поддерживает уровни переопрделения, которые позволяют разрабатывать общий код компонентов на отдельном уровне и подключать в сборку.

## Кроссплатформенная разработка

Чтобы разрабатывать современные веб-проекты, необходимо поддерживать несколько платформ (минимум, для настольных и мобильных устройств). Наиболее распространены два подхода:
* отдельная версия для каждой платформы
* одна адаптивная версия

Разработка отдельных версий требует дополнительных ресурсов: чем больше платформ необходимо поддерживать, тем больше усилий уходит на разработку. Создание отдельных версий приводит к проблемам повторного использования кода и поддержки синхронного состояния в релизах и разработке.

Разработка адаптивной версии усложняет код и увеличивает требования к квалификации разработчиков. Еще одна распространенная проблема адаптивных версий — снижение производительности сервиса, особенно на мобильных устройствах.

> Библиотека bem-react-core поддерживает уровни переопрделения, которые позволяют разрабатывать приложения для разных платформ и подключать в сборку только нужный код.

## Эксперименты

Чтобы успешно разрабатывать проекты с большой аудиторией нужно быть уверенным в каждом изменении. A/B эксперименты, это один из способов получить такую уверенность.

Наиболее распространенные способы организации кода для проведения экспериментов:
- ветвление всей кодовой базы и создание отдельных экземпляров сервиса
- точечные условия внутри одной кодовой базы

Ветвление кодовой базы может вызвать существенные дополнительные расходы в случае большого количества длительных экспериментов. Каждую ветку с экспериментом необходимо поддерживать в актуальном состоянии: синхронизировать изменения, например, исправленные ошибки, продуктовую функциональность, не требующую экспериментов и/или успешно их прошедшую. Кроме этого, ветвление кодовой базы усложняет проведение пересекающихся экспериментов.

Точечные условия внутри одной кодовой базы работают гибче, но ведут к усложнению самой кодовой базы: условия эксперимента могут затрагивать разные части основного кода проекта. Большое количество условий затрудняет не только понимание кода для человека, но и ухудшает производительность (за счет увеличения объема кода для браузера). Каждый раз, когда эксперимент завершен, необходимо удалить лишний код: убрать условия и сделать код основным или полностью удалить неудачный эксперимент. 

> Библиотека bem-react-core поддерживает уровни переопрделения, которые позволяют проводить эксперименты на отдельном уровне, не затрагивая основной код проекта.

## Взаимодействие общей библиотеки компонентов и разных сервисов

Чтобы использовать в проекте библиотеку общих компонентов, необходимо уметь изменять исходный код этой библиотеки. Например, изменять API, улучшать и оптимизировать код, добавлять функциональность. 

Любая сторонняя библиотека общих компонентов имеет свой релизный цикл. Компоненты в такой библиотеке универсальные на столько, на сколько это задумывалось авторами. 
Существует несколько способов внести изменения в компоненты из библиотеки на уровне своего проекта:
* форк библиотеки
* патчинг кода библиотеки в рантайме
* наследование

При форке библиотеки необходимо следить за обновлениями в апстриме и накладывать патчи.

Патчинг библиотечного кода в рантайме в некоторых случаях невозможен, так как авторы библиотеки не предусмотрели возможность для внешних изменений. Так же авторы библиотеки не учитывают сторонние патчи при выпуске новых версий, что существенно усложняет обновление до новых версий.

Наследование используется, если необходимо получить измененный компонент из библиотеки. Например, можно создать компонент `MyButton`, унаследованный от `Button` из библиотеки. Но унаследованный `MyButton` не применится ко всем компонентам из библиотеки, содержащим кнопки. Например, в библиотеке может быть компонент `Search`, построенный композицией из `Input` и `Button`. В этом случае, используя компонент `Search` вы не получите внутри него унаследованный `MyButton`. 

> Библиотека bem-react-core поддерживает уровни переопрделения, которые позволяют гибко изменять код библиотеки общих компонентов и не зависеть от обновлений библиотеки.
